apiVersion: v1
kind: ConfigMap
metadata:
  name: oauth2-proxy-value-overrides
  namespace: keycloak
data:
  values.yaml: |-
    config:
      existingSecret: oauth2-proxy-secrets
      httpScheme: http
      containerPort: 80
      configFile: |+
        reverse_proxy = "true"
        email_domains = [ "*" ]
        upstreams = [ "file:///dev/null" ]
        cookie_secure = "true"
        cookie_domains = [ ".kubernasty.micahrl.com" ]
        whitelist_domains = [ ".kubernasty.micahrl.com" ]
        provider = "keycloak-oidc"
        provider_display_name = "Kubernasty Keycloak"
        redirect_url = "https://oauth2-proxy.kubernasty.micahrl.com/oauth2/callback"
        oidc_issuer_url = "https://keycloak.kubernasty.micahrl.com/auth/realms/master"
        allowed_roles = "kubernasty-oauth2-proxy:kubernasty-apps-all"
        user_id_claim = "oid"

        # <https://github.com/oauth2-proxy/oauth2-proxy/issues/1669#issuecomment-1166633784>
        scope = "email"
