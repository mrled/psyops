apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-ldap
  namespace: grafana
data:
  ldap.toml: |+

    [[servers]]
    host = dirsrv.directory.svc.cluster.local
    port = 636
    use_ssl = true
    start_tls = false
    ssl_skip_verify = false

    bind_dn = "uid=authenticator,ou=services,dc=micahrl,dc=me"
    bind_password = "${LDAP_BIND_PASSWORD}"

    search_filter = (&(objectClass=inetOrgPerson)(memberOf=cn=grafana-users,ou=groups,dc=micahrl,dc=me)(uid=%s))
    search_base_dns = ["dc=micahrl,dc=me"]

    group_search_filter = "(&(objectClass=groupOfNames)(|(member=uid=%s,ou=people,dc=micahrl,dc=me)(member=uid=%s,ou=services,dc=micahrl,dc=me)))"
    group_search_filter_user_attribute = "dn"
    group_search_base_dns = ["ou=groups,dc=micahrl,dc=me"]

    [servers.attributes]
    member_of = "memberOf"
    email =  "mail"

    [[servers.group_mappings]]
    group_dn = "cn=grafana-admins,ou=groups,dc=micahrl,dc=me"
    org_role = "Admin"
    grafana_admin = true
