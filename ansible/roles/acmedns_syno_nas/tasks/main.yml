---

- name: Fix homedir permissions
  # SSH won't accept key auth if homedir is world/group writable, which it is by default on Synology
  file:
    path: "{{ lookup('env', 'HOME') }}"
    mode: "0700"
    state: directory

- name: Install SSH key
  authorized_key:
    user: "{{ acmedns_syno_nas_user }}"
    state: present
    key: "{{ acmedns_syno_nas_ssh_pubkey }}"

- name: Allow passwordless sudo
  copy:
    content: |+
      {{ acmedns_syno_nas_user }} ALL=(ALL) NOPASSWD: ALL
    dest: /etc/sudoers.d/{{ acmedns_syno_nas_user }}_passwordless
    owner: root
    group: root
    mode: "0600"
