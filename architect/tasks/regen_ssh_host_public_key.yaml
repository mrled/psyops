---
- name: Save SSH host private key (temporarily)
  copy:
    content: "{{ architect_ssh_host_ecdsa_key_b64 | b64decode }}"
    dest: "{{ workdir }}/ssh_host_ecdsa_key"

- name: Get SSH host public ECDSA key
  command: ssh-keygen -y -f "{{ workdir }}/ssh_host_ecdsa_key"
  register: ssh_host_public_ecdsa_key_result

- set_fact:
    ssh_host_public_ecdsa_key: "{{ ssh_host_public_ecdsa_key_result.stdout }}"

- name: Save SSH host public ECDSA key
  copy:
    content: "{{ ssh_host_public_ecdsa_key }}"
    dest: "{{ workdir }}/ssh_host_ecdsa_key.pub"

- name: Get SSH host public ECDSA fingerprint
  command: ssh-keygen -l -f "{{ workdir }}/ssh_host_ecdsa_key.pub"
  register: ssh_host_public_ecdsa_key_fingerprint_result

- set_fact:
    ssh_host_public_ecdsa_key_fingerprint: "{{ ssh_host_public_ecdsa_key_fingerprint_result.stdout }}"

- name: Remove host private key
  file:
    state: absent
    path: "{{ workdir }}/ssh_host_ecdsa_key"
