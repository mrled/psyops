---

- name: Deploy the Architect KMS template
  cloudformation:
    aws_access_key: "{{ aws_access_key }}"
    aws_secret_key: "{{ aws_secret_key }}"
    stack_name: "{{ architect_kms_stack_name }}"
    state: "present"
    region: "{{ aws_region }}"
    template: "roles/cfn_architect_kms/files/architect.kms.cfn.yaml"
    tags:
      Environment: Architect
  register: architect_kms_stack_result

- set_fact:
    architect_kms_id: "{{ architect_kms_stack_result.stack_outputs.ArchitectKmsId }}"
    architect_iam_profile_name: "{{ architect_kms_stack_result.stack_outputs.ArchitectInstanceIamProfileName }}"
